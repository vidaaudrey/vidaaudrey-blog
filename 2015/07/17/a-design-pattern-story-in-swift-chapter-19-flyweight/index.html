<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A Design Pattern Story in Swift – Chapter 19: Flyweight</title>
  <meta name="description" content="It’s hard to get things done without a system to share and prioritize.  There are thousands of soldiers in the army, but only few of them are commanders. How...">
  <link rel="canonical" href="http://audreyli.me/2015/07/17/a-design-pattern-story-in-swift-chapter-19-flyweight/">
  
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=RobotoDraft:100,300,400|Roboto:300,300italic,400">
  <!-- Boostrap -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  
  <!-- inject:css -->
  <link rel="stylesheet" href="/assets/stylesheets/style.css">
  <!-- endinject -->

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://audreyli.me/feed.xml" title="vidaaudrey-blog" />
</head>

  
  <body>
    <nav id="push_sidebar">
    <div class="social-icons">
        <img src="/assets/images/audrey-li.jpg" alt="Audrey's Photo" class="img-circle">

        <a href="https://github.com/vidaaudrey" title="Audrey's Github">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-github fa-stack-1x fa-inverse"></i>
            </span>
        </a>
        <a href="https://www.facebook.com/audreyauli" title="Audrey's Facebook">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
            </span>
        </a>

        <a href="https://www.linkedin.com/in/audreyauli" title="Audrey's Google Plus">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
        </a>
        
        <a href="/assets/images/wechat.jpg" title="Audrey's Wechat">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-weixin fa-stack-1x fa-inverse"></i>
            </span>
        </a>

    </div>

    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/portfolio">Portfolio</a></li>
      <li><a href="/archives">Archives</a></li>
      <li><a href="/atom.xml">Feed</a></li>
      <li class="rss-subscribe">subscribe <a href="feed.xml">via RSS</a></li>
      <li><a href="/about">About</a></li>
    </ul>
</nav>


    <div id="body-wrap">
      <header class="nav-down"  id="wrapper">
    <div class="container-fluid">
       <a class="navbar-brand" href="/"><img alt="Brand" src="/assets/images/normal/logo-dark-round.png"></a>
       <span class="nav_trigger"><i class="fa fa-bars"></i></span>
    </div>
</header>

      

<!-- jumbotron for pages -->

<!-- jumbotron for post page, with feature image -->
  
      <div class="jumbotron jumbotron-post" style="background-image: url('/assets/images/wp-content/uploads/2015/07/army1.jpg')">
         <div class="fullwidth-wrapper">
    <div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12 ">
      <div class="main-wrap">
           <h2 class="post-title">A Design Pattern Story in Swift – Chapter 19: Flyweight</h2>
            <p class="post-date">17 Jul 2015</p>
      </div>
    </div>
</div>
        
      </div>

  <!-- jumbotron for post page, without feature image -->
  






      <main class="row">
          <div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12 ">
              <div class="main-wrap">
                <div class="post card post-content">
   <div class="page" title="Page 333">
  <div class="layoutArea">
    <div class="column">
      <p>
        It&#8217;s hard to get things done without a system to share and prioritize.  There are thousands of soldiers in the army, but only few of them are commanders. How can we quickly go through all the soldiers to find the commanders, their ranks, and how much power the army has together?
      </p>
      
      <blockquote>
        <p>
          The flyweight pattern shares common data objects between multiple calling components.  It reduces the amount of memory needed to create the data objects required by the calling components and the amount of work required to create them. The impact of implementing the pattern increases with the number of calling components that share the data.  <em><a href="http://www.apress.com/9781484203958">Design Pattern in Swift</a> (The code is also referred by the book)</em>
        </p>
      </blockquote>
    </div>
  </div>
</div>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">struct</span> <span class="n">Soldier</span><span class="p">{</span>
    <span class="k">let</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span>
    <span class="k">let</span> <span class="kt">id</span><span class="o">:</span> <span class="n">Int</span>
    <span class="k">var</span> <span class="nl">rank</span><span class="p">:</span> <span class="n">Int</span>
    <span class="k">var</span> <span class="nl">hashValue</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">name</span><span class="p">.</span><span class="n">hashValue</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="o">==</span> <span class="p">(</span><span class="nl">lhs</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">,</span> <span class="nl">rhs</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="kt">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">.</span><span class="kt">id</span> <span class="o">&amp;&amp;</span> <span class="n">lhs</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">.</span><span class="n">name</span>
<span class="p">}</span>

<span class="k">extension</span> <span class="n">Dictionary</span> <span class="p">{</span>
    <span class="k">init</span><span class="p">(</span><span class="nl">setupFunc</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">[(</span><span class="n">Key</span><span class="p">,</span> <span class="n">Value</span><span class="p">)])){</span>
        <span class="nb">self</span><span class="p">.</span><span class="k">init</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">setupFunc</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">[</span><span class="n">item</span><span class="mf">.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="mf">.1</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">protocol</span> <span class="n">Flyweight</span> <span class="p">{</span>
    <span class="k">subscript</span><span class="p">(</span><span class="kt">id</span><span class="o">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Soldier</span><span class="o">?</span> <span class="p">{</span> <span class="kr">get</span> <span class="kr">set</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nl">totalPower</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nl">numberOfCommanders</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//: There are thousands of soldiers in the army, most of which are lower level soldiers, but some are commanders with higher rank</span>
<span class="c1">//: extrinsic holds all soldiers, intrinsic represent those who are commanders (who&#39;s rank has been updated to higher level).</span>

<span class="k">class</span> <span class="nl">ArmyFlyweight</span><span class="p">:</span> <span class="n">Flyweight</span> <span class="p">{</span>
    <span class="n">private</span> <span class="k">let</span> <span class="nl">extrinsicArmy</span><span class="p">:</span> <span class="p">[</span><span class="nl">Int</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">]</span>
    <span class="n">private</span> <span class="k">var</span> <span class="nl">intrinsicArmy</span><span class="p">:</span> <span class="p">[</span><span class="nl">Int</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">]</span>
    <span class="n">private</span> <span class="k">let</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;dataQ&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">)</span>
    
    <span class="k">init</span><span class="p">(</span><span class="nl">soldiers</span><span class="p">:</span> <span class="p">[</span><span class="nl">Int</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">])</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">extrinsicArmy</span> <span class="o">=</span> <span class="n">soldiers</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">intrinsicArmy</span> <span class="o">=</span> <span class="p">[</span><span class="o">:</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="k">subscript</span><span class="p">(</span><span class="kt">id</span><span class="o">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Soldier</span><span class="o">?</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nl">result</span><span class="p">:</span> <span class="n">Soldier</span><span class="o">?</span>
            <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
                <span class="n">guard</span> <span class="k">let</span> <span class="n">soldier</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">intrinsicArmy</span><span class="p">[</span><span class="kt">id</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">result</span> <span class="o">=</span>  <span class="nb">self</span><span class="p">.</span><span class="n">extrinsicArmy</span><span class="p">[</span><span class="kt">id</span><span class="p">]</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">soldier</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="p">}</span>
        <span class="kr">set</span><span class="p">(</span><span class="n">newSoldier</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">newSoldier</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="p">{</span>
                <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
                    <span class="nb">self</span><span class="p">.</span><span class="n">intrinsicArmy</span><span class="p">[</span><span class="kt">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">newSoldier</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// each of the soldier&#39;s power = rank * rank, initial rank for soliders is 0.</span>
    <span class="k">var</span> <span class="nl">totalPower</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">intrinsicArmy</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">map</span><span class="p">{</span><span class="err">$</span><span class="mf">0.</span><span class="n">rank</span> <span class="o">*</span> <span class="err">$</span><span class="mf">0.</span><span class="n">rank</span><span class="p">}.</span><span class="n">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nl">combine</span><span class="p">:</span> <span class="o">+</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nl">numberOfCommanders</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">intrinsicArmy</span><span class="p">.</span><span class="n">count</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
    
<span class="p">}</span>


<span class="k">class</span> <span class="n">FlyweightFactory</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">var</span> <span class="nl">numberOfSoldiers</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">{</span>
        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="n">print</span><span class="p">(</span><span class="s">&quot;Set the total number of soldiers to be \(numberOfSoldiers)&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">class</span> <span class="k">func</span> <span class="n">createFlyweight</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Flyweight</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ArmyFlyweight</span><span class="p">(</span><span class="nl">soldiers</span><span class="p">:</span> <span class="n">extrinsicArmy</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="n">private</span> <span class="k">class</span> <span class="k">var</span> <span class="nl">extrinsicArmy</span><span class="p">:</span> <span class="p">[</span><span class="nl">Int</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">]</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="k">struct</span> <span class="n">singletonWrapper</span> <span class="p">{</span>
                <span class="k">static</span> <span class="k">let</span> <span class="n">singleton</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Soldier</span><span class="o">&gt;</span><span class="p">(</span>
                    <span class="nl">setupFunc</span><span class="p">:</span> <span class="p">{</span> <span class="p">()</span> <span class="k">in</span>
                        <span class="k">var</span> <span class="nl">results</span><span class="p">:[(</span><span class="n">Int</span><span class="p">,</span> <span class="n">Soldier</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">FlyweightFactory</span><span class="p">.</span><span class="n">numberOfSoldiers</span> <span class="p">{</span>
                            <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Soldier</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="s">&quot;Sol#\(i)&quot;</span><span class="p">,</span> <span class="kt">id</span><span class="o">:</span> <span class="n">i</span><span class="p">,</span> <span class="nl">rank</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>
                        <span class="p">}</span>
                        <span class="k">return</span> <span class="n">results</span>
                    <span class="p">}</span>
                    
                <span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">singletonWrapper</span><span class="p">.</span><span class="n">singleton</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nl">Army</span><span class="p">:</span> <span class="n">CustomStringConvertible</span> <span class="p">{</span>
    <span class="n">private</span> <span class="k">var</span> <span class="nl">soldiers</span><span class="p">:</span> <span class="n">Flyweight</span>
    <span class="k">init</span><span class="p">(){</span>
        <span class="n">soldiers</span> <span class="o">=</span> <span class="n">FlyweightFactory</span><span class="p">.</span><span class="n">createFlyweight</span><span class="p">()</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Army created!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nl">description</span><span class="p">:</span> <span class="n">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Total soldiers: \(FlyweightFactory.numberOfSoldiers). Total commanders: \(numberOfCommanders). Total Power:\(totalPower) </span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="p">}</span>
    <span class="k">func</span> <span class="n">setRankBySoldier</span><span class="p">(</span><span class="k">var</span> <span class="nl">soldier</span><span class="p">:</span> <span class="n">Soldier</span><span class="p">,</span> <span class="nl">newRank</span><span class="p">:</span> <span class="n">Int</span><span class="p">){</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Setting \(soldier.name)&#39;s rank to be \(newRank)&quot;</span><span class="p">)</span>
        <span class="n">soldier</span><span class="p">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">newRank</span>
        <span class="n">soldiers</span><span class="p">[</span><span class="n">soldier</span><span class="p">.</span><span class="kt">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">soldier</span>
    <span class="p">}</span>
    <span class="k">func</span> <span class="n">getSoliderById</span><span class="p">(</span><span class="kt">id</span><span class="o">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Soldier</span><span class="o">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">soldiers</span><span class="p">[</span><span class="kt">id</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="k">func</span> <span class="n">setRankById</span><span class="p">(</span><span class="kt">id</span><span class="o">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">newRank</span><span class="p">:</span> <span class="n">Int</span><span class="p">){</span>
        <span class="k">if</span> <span class="k">var</span> <span class="n">oldSoldier</span> <span class="o">=</span> <span class="n">soldiers</span><span class="p">[</span><span class="kt">id</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">print</span><span class="p">(</span><span class="s">&quot;Setting \(oldSoldier.name)&#39;s rank to be \(newRank)&quot;</span><span class="p">)</span>
            <span class="n">oldSoldier</span><span class="p">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">newRank</span>
            <span class="n">soldiers</span><span class="p">[</span><span class="n">oldSoldier</span><span class="p">.</span><span class="kt">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldSoldier</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">print</span><span class="p">(</span><span class="s">&quot;Failed! Trying to set rank to an unknown soldier whose id is \(id)&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">func</span> <span class="n">getCommanderNames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Trying to get commanders&#39; names&quot;</span><span class="p">)</span>
        <span class="n">guard</span> <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">soldiers</span> <span class="kt">as</span><span class="o">?</span> <span class="n">ArmyFlyweight</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Failed to get commanders&#39; names&quot;</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">intrinsicArmy</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">map</span><span class="p">{</span><span class="err">$</span><span class="mf">0.</span><span class="n">name</span><span class="p">}.</span><span class="n">reduce</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">){</span> <span class="err">$</span><span class="mi">0</span> <span class="o">+</span> <span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="err">$</span><span class="mi">1</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nl">totalPower</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">soldiers</span><span class="p">.</span><span class="n">totalPower</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nl">numberOfCommanders</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">soldiers</span><span class="p">.</span><span class="n">numberOfCommanders</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//: Testing</span>
<span class="k">let</span> <span class="n">totalNumberOfSoldiers</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">FlyweightFactory</span><span class="p">.</span><span class="n">numberOfSoldiers</span> <span class="o">=</span> <span class="n">totalNumberOfSoldiers</span>
<span class="k">let</span> <span class="n">army1</span> <span class="o">=</span> <span class="n">Army</span><span class="p">()</span>
<span class="n">print</span><span class="p">(</span><span class="n">army1</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
<span class="k">let</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">army1</span><span class="p">.</span><span class="n">getSoliderById</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mf">.10</span> <span class="p">{</span>
    <span class="n">army1</span><span class="p">.</span><span class="n">setRankById</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">24000</span><span class="p">))</span> <span class="p">,</span> <span class="nl">newRank</span><span class="p">:</span> <span class="n">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">army1</span><span class="p">.</span><span class="n">setRankBySoldier</span><span class="p">(</span><span class="n">sol1</span><span class="o">!</span><span class="p">,</span> <span class="nl">newRank</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">army1</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">army1</span><span class="p">.</span><span class="n">getCommanderNames</span><span class="p">())</span>

<span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span><span class="err">&#39;</span></code></pre></figure>

<p><a href="/assets/images/wp-content/uploads/2015/07/Flyweight.png"><img class="aligncenter size-full wp-image-1074" src="/assets/images/wp-content/uploads/2015/07/Flyweight.png" alt="Flyweight" width="647" height="326" /></a></p>

 </div>
 <div class="card">
   <div class="page-nav">
    <div>
        
         <a class="prev" href="/2015/07/15/a-design-pattern-story-in-swift-chapter-18-visitor/"> <i class="fa fa-angle-left"></i></a> 
          <a class="prev" href="/2015/07/15/a-design-pattern-story-in-swift-chapter-18-visitor/"> A Design Pattern Story in Swift – Chapter 18: Visitor</a>
        
    </div>
    <div>
        
          <a class="next" href="/2015/07/18/a-design-pattern-story-in-swift-chapter-20-mediator/">A Design Pattern Story in Swift – Chapter 20: Mediator </a>
         <a class="prev" href="/2015/07/18/a-design-pattern-story-in-swift-chapter-20-mediator/"> <i class="fa fa-angle-right"></i></a> 
        
    </div>
</div>



 </div>
 <div class="related card">
   <h2>Related Posts</h2>
   <ul class="related-posts">
     
       <li>
         <h4>
           <a href="/general/2015/11/11/singles-day/">
             Singles Day
             <small>11 Nov 2015</small>
           </a>
         </h4>
       </li>
     
       <li>
         <h4>
           <a href="/jekyll/2015/09/27/relocating-my-blog-from-wordpress-to-Jekyll/">
             Relocating My Blog from Wordpress to Jekyll
             <small>27 Sep 2015</small>
           </a>
         </h4>
       </li>
     
       <li>
         <h4>
           <a href="/2015/07/18/a-design-pattern-story-in-swift-chapter-21-interpretor/">
             A Design Pattern Story in Swift – Chapter 21: Interpretor
             <small>18 Jul 2015</small>
           </a>
         </h4>
       </li>
     
   </ul>
 </div>
 <div class="card">
 <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'audreyli';
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
 </div>
 

      
    




              </div>
          </div>
          
      </main>
      <footer class="row">
    <div class="col-md-8 col-md-offset-2 text-center">
        <a href="http://audreyli.me">  &copy; Copyright 2015 &nbsp; &nbsp; AudreyLi.me &nbsp; &nbsp;</a> 
       
        <a href="/archives">Archives &nbsp; &nbsp; </a>
        <a href="https://github.com/vidaaudrey" title="Audrey's Github">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-github fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    
        <a href="https://www.linkedin.com/in/audreyauli" title="Audrey's Google Plus">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
        </a>
        
        <a href="/feed.xml" title="RSS Feed">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </div>
    
</footer>

      
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js"></script>
<script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js"></script>

<!-- inject:js -->
<script src="/assets/javascript/index.js"></script>
<!-- endinject -->

  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68084914-1', 'auto');
    ga('send', 'pageview');

  </script>
  </body>
</html>
